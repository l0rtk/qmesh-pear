import MLCInference = require('@tetherto/qvac-lib-inference-addon-mlc-base')
import QvacResponse from '@tetherto/qvac-lib-response'

type AppendInput = {
  type: 'audio' | 'end of job'
  input?: ArrayBuffer
  priority?: number
}

interface DecoderConfig {
  audioFormat?: string
  sampleRate?: number
  [key: string]: any
}

interface AudioStream {
  [Symbol.asyncIterator](): AsyncIterator<{ buffer: Buffer }>
}

interface Addon {
  activate(): Promise<void>
  append(input: AppendInput): Promise<number>
  cancel(jobId: number): Promise<void>
  pause(): Promise<void>
  continue(): Promise<void>
  status(): Promise<any>
  loadWeights?(params: {
    filename: string
    contents?: Buffer
    completed: boolean
  }): Promise<void>
}

interface GSTDecoderConstructorParams {
  config: DecoderConfig
  [key: string]: any
}

/**
 * GSTDecoder client implementation for the Whisper transcription model
 */
declare class GSTDecoder extends MLCInference {
  /**
   * Creates an instance of GSTDecoder.
   * @constructor
   * @param {Object} config - environment-specific inference setup configuration
   */
  constructor({ config, ...args }: GSTDecoderConstructorParams)
  private config: DecoderConfig
  private addon: Addon
  load(): Promise<void>
  createAddon(config: DecoderConfig): Addon
  protected _runInternal(audioStream: AudioStream): Promise<QvacResponse>
  getStatus(): Promise<any>
}

export = GSTDecoder
